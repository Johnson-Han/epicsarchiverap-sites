<h1 id="a-site-specific-ess-epics-archiver-appliance-deployment">A Site-Specific (ESS) EPICS Archiver Appliance Deployment</h1>
<h1 id="requirements">Requirements</h1>
<ul>
<li>CentOS 7 (Tested with 7.2 1511 &amp; 7.3 1611)</li>
</ul>
<h1 id="license">License</h1>
<ul>
<li>All works done by the original Archiver Appliance follows its original Licenses. Please check them in https://github.com/slacmshankar/epicsarchiverap/blob/master/NOTICE</li>
<li>Makefile, to build any documents, follows its original License also. Please check it in http://www.bouncingchairs.net/oss</li>
<li>In addition, The works in this repository can be distributed under the GPL-2 license.</li>
</ul>
<h1 id="archiver-appliance-setup-on-centos-7">Archiver Appliance Setup on CentOS 7</h1>
<p>With the following commands, one can setup an Archiver Appliance quite easily on CentOS 7</p>
<pre><code>$ curl -L https://git.io/vXSN6 -o aa_init.bash
$ bash aa_init.bash 
$ cd epicsarchiverap-sites/
$ bash 00_preAA.bash all
$ bash 01_aaBuild.bash 
$ bash 02_aaSetup.bash 
$ bash 03_aaDeploy.bash</code></pre>
<h1 id="files">Files</h1>
<h2 id="setenvaa.bash">setEnvAA.bash</h2>
<ul>
<li>almost all important variables are defined</li>
<li>E.g., TOMCAT_HOME, EPICS_BASE, ARCHAPPL_TOP, LD_LIBRARY_PATH, and so on...</li>
</ul>
<h2 id="aa_init.bash">aa_init.bash</h2>
<ul>
<li>sudo permission is needed.</li>
<li>Remove the cumbersome package (PackageKit)</li>
<li>Install pre-required packages (git, epel-release, tree)</li>
<li>Do git clone the current repository</li>
</ul>
<h2 id="preaa.bash">00_preAA.bash</h2>
<ul>
<li>sudo permission is needed.</li>
<li>Remove the cumbersome package (PackageKit)</li>
<li>Install pre-required packages (git, epel-release, tree)</li>
<li>Do mkdir local storages (STS, MTS, LTS)</li>
<li>Install necessary packages for Archappl (ntp, java-1.8.0-openjdk, mariadb, tomcat, etc)</li>
<li>Install necessary packages for EPICS base (....)</li>
<li>Start ntpd, mariadb, and tomcate services through systemd</li>
<li>Install EPICS base</li>
<li>Setup MariaDB (Secure MySQL Setup)</li>
<li>Prepare mariadb-connector-j from github.com (Binary can be downloaded with login in MariaDB site)</li>
<li>(Optional) Replace Gnome with Mate and replace gdm with lightdm</li>
<li>(Optional) do yum update</li>
</ul>
<h2 id="aabuild.bash">01_aaBuild.bash</h2>
<ul>
<li>Download Archappl from https://github.com/slacmshankar/epicsarchiverap</li>
<li>Select a version</li>
<li>Build the selected version</li>
</ul>
<h2 id="aasetup.bash">02_aaSetup.bash</h2>
<ul>
<li>Prepare the target directories <span class="math"><em>S</em><em>C</em><sub><em>D</em></sub><em>E</em><em>P</em><em>L</em><em>O</em><em>Y</em><sub><em>D</em></sub><em>I</em><em>R</em></span>{ARCHAPPL_TOP}</li>
<li>Put log4j.properties in ${TOMCAT_HOME}/lib</li>
<li>Put appliances.xml in ${ARCHAPPL_TOP}</li>
<li>Deploy multiple tomcats into ${ARCHAPPL_TOP}</li>
<li>Put context.xml in to ${ARCHAPPL_TOP}/mgmt/conf/</li>
<li>Create DB tables into DB ${DB_NAME}</li>
</ul>
<h2 id="aadeploy.bash">03_aaDeploy.bash</h2>
<ul>
<li>Deploying a new release from mgmt, engine, etl, retrieval onto ${ARCHAPPL_TOP}&quot;</li>
<li>Modifying the static contents, images, and css for the ESS site specific information</li>
</ul>
<h2 id="aaservice.bash">aaService.bash</h2>
<ul>
<li>Service start/stop/restart</li>
</ul>
<h1 id="commands">Commands</h1>
<ul>
<li>Only Command List</li>
</ul>
<pre><code>[aauser@ ]$ curl -L https://git.io/vXSN6 -o aa_init.bash
[aauser@ ]$ bash aa_init.bash 
[aauser@ ]$ cd epicsarchiverap-sites/
[aauser@ epicsarchiverap-sites]$ bash 00_preAA.bash all
[aauser@ epicsarchiverap-sites]$ bash 01_aaBuild.bash 
 0: git src                             master
 1: git src   v0.0.1_SNAPSHOT_03-November-2015
 2: git src        v0.0.1_SNAPSHOT_10-Sep-2015
 3: git src        v0.0.1_SNAPSHOT_12-May-2016
 4: git src        v0.0.1_SNAPSHOT_12-Oct-2016
 5: git src       v0.0.1_SNAPSHOT_20-Sept-2016
 6: git src       v0.0.1_SNAPSHOT_22-June-2016
 7: git src        v0.0.1_SNAPSHOT_23-Sep-2015
 8: git src    v0.0.1_SNAPSHOT_26-January-2016
 9: git src       v0.0.1_SNAPSHOT_29-July-2015
10: git src      v0.0.1_SNAPSHOT_30-March-2016
Select master or one of tags which can be built, followed by [ENTER]:

[aauser@ epicsarchiverap-sites]$ bash 02_aaSetup.bash 
[aauser@ epicsarchiverap-sites]$ bash 03_aaDeploy.bash
[aauser@ epicsarchiverap-sites]$ sudo su
[root@ epicsarchiverap-sites]# bash aaService.bash start
[root@ epicsarchiverap-sites]# bash aaService.bash stop</code></pre>
<p>--</p>
<div class="figure">
<img src="aa_site_specific.png" alt="Connection Example" /><p class="caption">Connection Example</p>
</div>
<h1 id="acknowledgement">Acknowledgement</h1>
<p>A special word of thanks goes to Murali Shankar who develops the Archiver Appliance and answers my stupid questions again and again and again.</p>
